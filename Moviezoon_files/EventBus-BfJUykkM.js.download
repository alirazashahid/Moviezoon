function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}define(["OK/EventFactoryForEventBus"],function(h){var c={};"use strict";var e=/*#__PURE__*/function(){"use strict";function i(s){var _this=this;var _this1=this;_class_call_check(this,i);this.listeners=new Map;this.emit=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return i.emit({prefix:_this1.prefix,name:_this1.name,data:t,target:r})};this.on=function(t,r){var u=_this.makeListener(t,r);if(u){i.on(u);return true}return false};this.off=function(t){var r=_this.listeners.get(t);if(r){i.off(r);_this.listeners.delete(t)}};this.isMe=function(t){return _this.name===t.name&&_this.prefix===t.prefix};this.makeListener=function(t,r){if(_this.listeners.has(t)){window.OK.logging.info("EventBus["+_this.prefix+", "+_this.name+"]: повторное добавление обработчика");return}var u=_this;var a=(function(f){var o=f.detail;if(f.defaultPrevented){return}if(!u.isMe(o)){return}if(r&&o.target&&r===o.target){return}return t(o.data)}).bind(_this);_this.listeners.set(t,a);return a};this.prefix=s.prefix;this.name=s.name}_create_class(i,null,[{key:"factory",value:function factory(s){return function(t){return i.create({prefix:s,name:t})}}}]);return i}();e.EVENT_NAME="okeventbus";e.eventHost=h.eventFactory.create();e.registeredBuses=new Set;e.getRegisteredBuses=function(){return e.registeredBuses};e.getHost=function(){return e.eventHost};e.createEvent=function(n){return new CustomEvent(e.EVENT_NAME,{detail:n,bubbles:false,cancelable:true})};e.on=function(n){if(e.hasListener(n)){throw new Error("EventBus: повторное добавление обработчика")}e.eventHost.attach(n)};e.off=function(n){e.eventHost.detach(n)};e.emit=function(n){var s=e.createEvent(n);e.eventHost.trigger(s);return!s.defaultPrevented};e.findRegistered=function(n){var s=null;e.registeredBuses.forEach(function(t){if(!s&&t.isMe(n)){s=t}});return s};e.create=function(n){return e.getInstance(n)};e.getInstance=function(n){var s=e.findRegistered(n);if(!s){s=new e(n);e.getRegisteredBuses().add(s)}return s};e.hasListener=function(n){var s=e.eventHost.list;return s.some(function(t){return t.handler===n})};var l=e;c.EventBus=l;return c});