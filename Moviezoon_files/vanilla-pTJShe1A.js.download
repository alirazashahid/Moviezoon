define(["OK/AjaxNavigationLog","OK/utils/screens","OK/logger"],function(V,J,Y){var i={};"use strict";function g(e){var n=[],t=function t(p,f){n.push(encodeURIComponent(p)+"="+encodeURIComponent(f))};for(var r in e){if(e.hasOwnProperty(r)){var s=e[r];if(Array.isArray(s)){s.forEach(t.bind(null,r))}else{t(r,e[r])}}}return n.join("&")}function R(e){var n=e&&e.indexOf("?");if(n===-1){return{path:e,query:{}}}return{path:e.substring(0,n),query:O(e)}}function O(e){var n={},t=e&&e.indexOf("?");if(t>-1){var r=e.substr(t+1);n=C(r)}return n}function C(e){var n={};if(!e){return n}var t=e.split("&");t.forEach(function(r){if(r.indexOf("=")>-1){var s=r.split("="),p=s[0],f=s[1];f=decodeURIComponent(f.replace(/\+/g,"%20"));n[p]=f}});return n}function H(e,n){if(n!=null){e+=(e.indexOf("?")===-1?"?":"&")+g(n)}return e}function P(e,n){var t,r;if(e.startsWith("/dk?cmd=")){t=e.indexOf("&")+1}else{t=e.indexOf("?")+1}if(t>0){r=e.substring(0,t-1);if(n){var s=e.substring(t);var p=C(s);Object.assign(n,p)}}else{r=e}return r}function y(e,n){var t=e.type||"POST",r=e.data||{},s=e.contentType,p=e.dataType,f=e.responseType,v=e.url||"",c=e.isExternal||/^(https?:)?\/\//.test(v),F=e.withCredentials||false,u={"xml":"application/xml, text/xml","html":"text/html","text":"text/plain","json":"application/json, text/javascript","*":"*/*"},o=e.headers||{},l={},D=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,B=e.beforeOpen,a=new XMLHttpRequest;if(!n){n=function n(m){if(OK.navigation.redirect){OK.navigation.redirect(m)}else{document.location.href=decodeURIComponent(m)}}}if(t==="POST"&&typeof r!=="string"){if(e.isFileUpload){o["Content-Type"]="application/octet-stream";var W=(r.name||"1.jpg").replace(/[^\u0000-\u007F]+/gi,"_").substring(0,255);o["Content-Disposition"]='attachment; filename="'+W+'"'}else{o["Content-Type"]="application/x-www-form-urlencoded";if(window.pageCtx.gwtHash){r["gwt.requested"]=window.pageCtx.gwtHash}r=g(r)}}if(s&&u.hasOwnProperty(s)&&!o.hasOwnProperty("Content-Type")){o["Content-Type"]=u[s]}if(p&&u.hasOwnProperty(p)&&!o.hasOwnProperty("Accept")){o["Accept"]=p==="*"?u[p]:u[p]+", */*; q=0.01"}if(!c&&!o.hasOwnProperty("TKN")){o["TKN"]=OK.tkn.get()}if(!c&&!o.hasOwnProperty("STRD")){o["STRD"]=OK.isStateRedesign()}if(!c&&!o.hasOwnProperty("STRV")){o["STRV"]=OK.getRedesignVersion()}if(!c){o[OK.CLIENT_FLAGS_HEADER]=OK.getClientFlags()}var M=OK.getStatId();if(!c&&M){o[OK.STAT_ID_HEADER]=M}var X=new Promise(function(m,d){var z=window.performance.now();if(B){B({xhr:a})}a.open(t,v,true);for(var w in o){if(o.hasOwnProperty(w)){a.setRequestHeader(w,o[w])}}if(!c){J.default.apply(a)}if(f){a.responseType=f}if(F){a.withCredentials=F}a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.HEADERS_RECEIVED){var Q=a.getAllResponseHeaders(),E;while(E=D.exec(Q)){l[E[1].toLowerCase()]=E[2]}if(!c&&l["redirect-location"]){n(l["redirect-location"]);d(a,a.statusText,"Redirect");return}}if(a.readyState!==XMLHttpRequest.DONE){return}if(a.status>=200&&a.status<300||a.status===304){V.default.log(window.performance.now()-z,v,a.getResponseHeader("X-Render-Time"));var j=f?a.response:a.responseText,G=j;if(p==="json"){try{G=JSON.parse(j)}catch($){d($)}}if(!c&&l["tkn"]){OK.tkn.set(l["tkn"])}if(!c&&l.hasOwnProperty(OK.CLIENT_FLAGS_HEADER)){OK.setClientFlags(l[OK.CLIENT_FLAGS_HEADER])}if(!c&&OK.state){window.OK.state.processXhrResponse(a)}OK.util.processCssHeaders(a).then(function(){m({response:G,xhr:a})})}else{d(a)}};a.onerror=function(){d(a)};var U=e.signal;if(U){U.addEventListener("abort",function(){a.abort();d(a)})}a.send(r)});X.xhr=a;return X}function k(e,n,t){return y(Object.assign({type:"GET",dataType:"json",url:e,data:n},t))}function x(e,n,t){if(!e||e.nodeType===3||e.nodeType===8){return}var r=document.createEvent("CustomEvent");r.initCustomEvent(n,true,true,t);e.dispatchEvent(r)}function K(e){var n=document.createElement("div");function t(r){n.innerText=r;return n.innerHTML}return e.split(" ").map(t).join(" ")}function T(e){var n=e.getResponseHeader(OK.navigation.HEADER);if(n){return n.split(",")}return null}function h(e,n){var t=e.split(OK.navigation.SPLITER);t.forEach(function(r,s){if(n[s]){OK.hookModel.setHookContent(n[s],r)}})}function S(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}function A(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function b(e){var n=document.createElement("div");n.innerHTML=e;return n.innerText}function I(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function L(e){var n=T(e.xhr);if(n){h(e.response,n)}}function N(e){return Array.prototype.slice.apply(e.getElementsByTagName("input")).reduce(function(n,t){if(t.name){n[t.name]=t.type==="checkbox"?t.checked?"on":"off":t.value}return n},{})}function _(e){if(e){return e.replace("hook_Block_","")}return null}var q={prepareForPost:P,ajax:y,getJSON:k,trigger:x,encodeHtml:K,parseLink:R,extractParams:O,stringifyParams:g,appendParamsToUrl:H,getBlockIds:T,updateBlocks:h,updateBlockModelCallback:L,getFormData:N,unescapeXml:S,escapeXml:A,stripTags:b,formatNumber:I,replaceHookBlockName:_};i.ajax=y;i.appendParamsToUrl=H;i.default=q;i.encodeHtml=K;i.escapeXml=A;i.extractParams=O;i.formatNumber=I;i.getBlockIds=T;i.getFormData=N;i.getJSON=k;i.parseLink=R;i.prepareForPost=P;i.replaceHookBlockName=_;i.stringifyParams=g;i.stripTags=b;i.trigger=x;i.unescapeXml=S;i.updateBlockModelCallback=L;i.updateBlocks=h;Object.defineProperty(i,"__esModule",{value:true});return i});