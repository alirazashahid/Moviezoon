define(["module","OK/logger","OK/utils/vanilla","OK/PackageRegistry","OK/AjaxNavigationLog","OK/utils/screens"],function(z,G,b,h,W,Y){var w={};"use strict";function K(e){return e&&e.__esModule?e:{default:e}}function U(e){if(e&&e.__esModule)return e;var n=Object.create(null);if(e){Object.keys(e).forEach(function(r){if(r!=="default"){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:true,get:function get(){return e[r]}})}})}n.default=e;return n}var $=U(z);var C=K(G);var p={},d=[],v={},A,q="$Hash$",N=$.config().timeout||3e5;function B(e){var n=v[e]||[],r=n.length;while(r--){n[r]()}}function M(e){return p.hasOwnProperty(e)}function a(e){var n=p[e];if((!n||Object.keys(n).length===0)&&OK.fn.isDebug()){console.error('Пакет "'+e+'" отсутствует. Наверно, не удалось загрузить')}return p[e]}function m(e,n){p[e]=new j(e,n);B(e);return a(e)}function j(e,n){this.pkg=e;this.messages=n;this.parsedResources={}}j.prototype={has:function has(e){return this.messages.hasOwnProperty(e)},getLMsg:function getLMsg(e,n){if(!e&&!n){return this.messages}var r=this.messages&&this.messages[e];if(typeof r!=="string"){C.default.success("pts.miss",this.pkg,e);return this.pkg+"."+e}if(n){var i=this.parsedResources[e];if(!i){i=F(r);this.parsedResources[e]=i}return i.getResource(n)}return r},subscribe:function subscribe(e){var n=this.pkg;if(!v[n]){v[n]=[]}v[n].push(e)}};function f(e){this.text=e}f.prototype.getResource=function(){return b.default.unescapeXml(b.default.encodeHtml(this.text))};function y(e){this.argName=e}y.prototype.getResource=function(e){var n=e[this.argName];return n||n===0?n:""};function I(e,n){this.argName=e;this.values=n}I.prototype.getResource=function(e){var n=e[this.argName],r=n,i=this.argName.substr(-"Plural".length)==="Plural";if(i){r=E.getIndex(n)}var u=this.values[r];if(u){return u.getResource(e)}return""};function L(e,n){this.argName=e;this.values=n}L.prototype.getResource=function(e){var n=e[this.argName],r=this.values[n];return r?r.getResource(e):""};function _(e){e=Math.abs(e);if(e%10===1&&e%100!==11){return 0}if(e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)){return 1}return 2}function g(e){return e===1?0:1}function c(e){return 0}var E={"ru":_,"uk":_,"en":g,"hy":g,"mo":g,"ro":g,"de":g,"uz":c,"az":c,"kk":c,"ka":c,"ky":c,"tg":c,"tr":c,getIndex:function getIndex(e){var n=document.body.parentElement.getAttribute("lang");var r=E[n];if(!r){r=_}return r(e)}};function S(e){this.children=e}S.prototype.getResource=function(e){var n="";for(var r=0;r<this.children.length;r++){n+=this.children[r].getResource(e)}return n};function F(e){var n=[];var r=0;for(;;){var i=T(n,e,r);if(i===e.length){break}if(r===i){i++}r=i}return P(n)}function T(e,n,r){var i;i=l(n,r,"|[]");if(i===-1){i=l(n,r,"]");if(i===-1){e.push(new f(n.substr(r)));return n.length}e.push(new f(n.substr(r,i-r)));return i}if(i>r){e.push(new f(n.substr(r,i-r)));return i}if(n[i]==="["){r=i+1;i=l(n,r,":?]");if(i===-1){r--;e.push(new f(n.substr(r)));return n.length}var u=J(n.substr(r,i-r));if(n[i]==="]"){e.push(new y(u));return i+1}var o=n[i],t=o==="?",s=t?{}:[];if(o!=="?"&&o!==":"){i=l(n,r,"]");e.push(new f(n.substr(r-1,i)));return n.length}for(;;){r=i+1;var R=[],D;if(t){i=l(n,r,"=");if(i>r){D=n.substr(r,i-r);r=i+1}else{i=l(n,r,"]");e.push(new f(n.substr(r,i)));return n.length}}for(;;){i=T(R,n,r);if(i===n.length){break}if(n[i]==="|"||n[i]==="]"){break}if(r==i){i++}r=i}if(t){s[D]=P(R)}else{s.push(P(R))}if(i===n.length||n[i]==="]"){break}}if(t){e.push(new L(u,s))}else{e.push(new I(u,s))}if(i===n.length){return n.length}return i+1}return i}function J(e){return e?e.replace(/^\s+|\s+$/gm,""):""}function P(e){if(e.length===0){return new f("")}if(e.length===1){return e[0]}return new S(e)}function l(e,n,r){for(var i=n;i<e.length;i++){for(var u=0;u<r.length;u++){if(r[u]===e[i]){return i}}}return-1}function V(){var e=[],n,r=0,i=d.length;for(;r<i;r+=1){n=d[r];var u=a(n);e.push({"pkg":n,"hash":u&&u.messages[q]||"0"})}return JSON.stringify(e)}function X(){b.default.ajax({url:"/web-api/upts",headers:{"Content-Type":"application/json"},data:V(),dataType:"json"}).then(function(e){var n=e.response,r=Object.keys(n),i,u=0,o=r.length;for(;u<o;u+=1){i=r[u];m(i,n[i])}})}function H(e){if(!e){return}if(d.indexOf(e)===-1){d.push(e)}if(!A&&N>0){A=window.setInterval(X,N)}}if(typeof window!=="undefined"){window.l10n={getPkg:function getPkg(e){H(e);return a(e)}};if(window.inline_resources!==void 0&&window.inline_resources.pts!==void 0){for(var O in window.inline_resources.pts){m(O,window.inline_resources.pts[O]);H(O)}window.inline_resources.pts={}}}function k(e,n,r,i){if(i.isBuild){r();return}var u=e.split(",");var o=u.filter(function(t){return!M(t)&&!h.hasPackagePromise(t)});o.sort();o.forEach(function(t){h.addPackagePromise(t)});if(o.length>0){n(["PTS/"+o.join(",")],function(t){o.forEach(function(s){m(s,t[s]);h.getPackageResolve(s)(a(s));h.deallocatePackage(s)})})}Promise.all(u.map(function(t){if(M(t)){return a(t)}return h.getPackagePromise(t)})).then(function(t){if(t.length===1){t=t[0]}r(t)})}var Q={load:k};w.default=Q;w.load=k;Object.defineProperty(w,"__esModule",{value:true});return w});